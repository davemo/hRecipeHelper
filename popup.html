<link type="text/css" href="css/le-frog-cust/jquery-ui-1.8.10.custom.css" rel="Stylesheet" />	
<link type="text/css" href="css/form-style.css" rel="Stylesheet" />	
<script type="text/javascript" src="js/jquery-1.4.4.min.js"></script>
<script type="text/javascript" src="js/jquery-ui-1.8.10.custom.min.js"></script>
<script type="text/javascript" src="js/jquery.url.js"></script>
<script type="text/javascript" src="js/formData.js"></script>
<script>

//TODO: finish time formatter in background for duration types
//TODO: Add proper value-title tags for the duration times so google will parse it. ex: <span class="value-title" title="PT1H30M"></span> (PT1H30M ? does the PT stand for Pacific time or something else?)
//TODO: Add Nutrition type drop down to specify Calories, fat, Total Carbs, Dietary Fiber, protein, sodium, Cholesterol
//TODO: Add validations (durations- require hh:mm format)
//TODO: Add save data to localstorage in case of accidentally closing.
//TODO: Add clear button to reset form if data was left in local storage.
//TODO: Add hRecipe format for nutrition types. Look into diff on value/type tags
//TODO: Add toggle to switch between pure hRecipe Spec and the Google version.
//TODO: Consider adding a non-formatting option that uses all span tags so sues can style their own.

//DONE: add duration types (preptime, cooktime, also compute total 'duration' )
//DONE: Fix Author output
//DONE: fix Duration Output.

	/**
	 * Loads existing hRecipe data into fields based on URL and presence of data.
	 */
	function loadBlogData() {
		console.log("Load Blog posting.");
		chrome.extension.getBackgroundPage().checkURLAction('load');
		$('#published').datepicker();
		$('#ok').button();
		$('#done').button();
		$('#close').button();
		$('#copy').button();
		$( "#tabs" ).tabs({
	    show: function(event, ui) { 		
		 }
		});
		$( "#tabs" ).bind( "tabsshow", function(event, ui) {
			if(ui.panel.id == "tabs-2") {
				console.log("Got Tab");
				var formData = initData();
				if(formData){
					var output = chrome.extension.getBackgroundPage().processData(formData);
					console.log("output="+output);
					$('#results').val(output);
				}
			}
		});
	}
	
	$(document).ready(loadBlogData);
	
	/**
	 * collect data and create dto.
	 */
	function initData() {
//TODO: Add form validation for name and ingredients : required and type checks for rest.	

		var formData = new FormData();		
		formData.$recname = $('#Rec-Name').val();		
		formData.$ingredients = getFormArray('ingredient');
		formData.$yield = $('#yield').val();
		//formData.$durations = getFormArray('duration');
		formData.$cooktime = $('#cook-time').val();
		formData.$preptime = $('#prep-time').val();
		formData.$photo = getFormArray('#photo');
		formData.$author = $('#author').val();
		formData.$published = $('#published').val();
		formData.$instructions = $('#instructions').val();
		formData.$nutritions = getFormArray('nutrition');
		formData.$summery = $('#summery').val();
		formData.$tags = $('#tag').val();
		
		return formData		
	}
	
	function done() {
		window.close();
	}
	
	/**
	 * retrieve array fo same name input fields.
	 */
	function getFormArray(id) {
		return $("input[id='"+id+"']").map(function(){return $(this).val();}).get();
	}
	
	function addFormField(fieldName) {
		var rowCt = $("#"+fieldName + "List li").size();
		debug(rowCt);
		$("#"+fieldName + "List").append("<li id='"+fieldName + "Row"+rowCt+"'><input type=\"text\" id=\""+fieldName+"\" name=\""+fieldName+"\"/></li>");
		$("#"+fieldName + "Row"+rowCt).effect("highlight", {}, 3000);		
	}

	$(function() {
		$( "#tabs" ).tabs();
	});
		
</script>

<html>
<head>
</head>
<body>
<div id="tabs">
	<ul>
		<li><a href="#tabs-1">Edit Recipe</a></li>
		<li><a href="#tabs-2">hRecipe Results</a></li>
	</ul>
	<div align="right"><input type="button" id="done" value="Close" onClick='done();'></div>
	<div id="tabs-1">
		<table>
			<tr><th><label for="Rec-Name">Name</label></th><td><input type="text" id="Rec-Name" name="Rec-Name" class="large-field"/></td></tr>
			<tr><th><label for="author">Author</label></th><td><input type="text" id="author" name="author"  class="large-field"/></div></td></tr>
			<tr><th><label for="published">Published</label></th><td><input type="text" id="published" name="published"/></td></tr>
			<tr><th><label for="yield">Yield</label></th><td><input type="text" id="yield" name="yield"/></td></tr>
			<tr><th><label for="summery">Summery</label></th><td><textarea id="summery" name="summery" rows="3" cols="30"></textarea></td></tr>
			<tr><th><label for="ingredient">Ingredients </label></th><td><a href="#" onClick="addFormField('ingredient'); return false;">add</a></td><tr>
			<tr><td colspan=2>
			<ul id='ingredientList'>
				<li><input type="text" id="ingredient" name="ingredient"/></li>
			</ul>
			</td></tr>
			<tr><th colspan=2><label for="instructions">Instructions</label></th>
			<tr><td colspan=2><textarea id="instructions" name="instructions" rows="6" cols="43"></textarea></td></tr>
			<tr><th><label for="prep-time">Prep Time</label></th><td><input type="text" id="prep-time" name="prep-time" class="large-field"/></td></tr>
			<tr><th><label for="cook-time">Cook Time</label></th><td><input type="text" id="cook-time" name="cook-time" class="large-field"/></td></tr>
			<tr><th><label for="photo">Photo</label></th><td><input type="text" id="photo" name="photo"  class="large-field"/></td></tr>
			<tr><th><label for="nutrition">Nutrition </label></th><td><a href="#" onClick="addFormField('nutrition'); return false;" alt="Add another">add</a></td></tr>
			<tr><td colspan=2>		
			<ul id='nutritionList'>
				<li><input type="text" id="nutrition" name="nutrition"/></li>
			<ul id='ingsList'>
			</td></tr>
			<tr><th><label for="tag">Tags</label></th><td><input type="text" id="tag" name="tag" class="large-field"/></td></tr>
		</table>
	</div>
	<div id="tabs-2">
		<div><label for="results">Results</label><textarea id="results" name="results" rows="20" cols="40"></textarea></div>
	</div>
</body>
</html>
